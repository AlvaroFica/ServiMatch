{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Elige un Plan</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/planes_servicio.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body { background: #f8f8fc; margin:0; font-family:sans-serif;}
    .planes-container {
      max-width: 430px; margin: 38px auto 0 auto; background: #fff;
      border-radius: 18px; box-shadow: 0 4px 24px #b9b7f350; padding: 30px 18px 25px 18px;
    }
    .planes-title {
      font-size:23px; color:#6a1bb1; font-weight:700;
      text-align:center; margin-bottom:26px;
    }
    .plan-card {
      border: 2px solid #e0e7ff; border-radius: 12px; margin-bottom: 20px;
      padding: 16px 13px 13px 13px; box-shadow: 0 2px 9px #ede6f670;
    }
    .plan-nombre { font-size: 18px; font-weight: 700; color: #6a1bb1; margin-bottom:2px;}
    .plan-precio { color: #4B0082; font-size: 15px; font-weight:600;}
    .plan-desc { color: #666; font-size:15px; margin: 9px 0 7px 0;}
    .plan-datos { color:#333; font-size:14px; margin-bottom:4px;}
    .plan-items { margin-top:6px; margin-bottom:7px; padding-left: 18px;}
    .plan-items li { color:#333; font-size:13.5px; margin-bottom:2px; }
    .btn-elegir {
      background: #6a1bb1; color: #fff; border: none; border-radius: 8px;
      padding: 8px 22px; font-size:15px; font-weight:600; cursor:pointer;
      margin-top: 8px; transition: background 0.15s;
      width: 100%;
    }
    .btn-elegir:hover { background: #4B0082; }
    .volver {
      display:block; text-align:center; margin: 32px 0 0 0;
    }
    .btn-volver {
      background: #6a1bb1; color: #fff; border: none; border-radius: 8px;
      padding: 10px 23px; font-size:16px; font-weight:600; cursor:pointer;
      margin-top: 12px;
    }
    .btn-volver:hover { background: #4B0082; }
  </style>
</head>
<body>
  <div class="planes-container">
    <div class="planes-title"><i class="fa fa-cubes"></i> Elige un Plan para Contratar</div>
    <div id="planes-lista">
      <div style="text-align:center;color:#aaa;">Cargando planes...</div>
    </div>
    <div class="volver">
      <button class="btn-volver" onclick="window.location.href='/mis_servicios/'"><i class="fa fa-arrow-left"></i> Volver</button>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const servicioId = "{{ servicio_id }}";
      const lista = document.getElementById('planes-lista');
      try {
        const resp = await fetch(`http://localhost:8000/api/planeservicio/?servicio=${servicioId}`);
        const planes = await resp.json();
        if (!planes.length) {
          lista.innerHTML = `<div style="text-align:center;color:#aaa;">No hay planes disponibles.</div>`;
          return;
        }
        lista.innerHTML = "";
        planes.forEach(plan => {
          let items = plan.incluye ? plan.incluye.split('\n') : [];
          lista.innerHTML += `
            <div class="plan-card">
              <div class="plan-nombre">${plan.nombre_plan}</div>
              <div class="plan-precio">$${plan.precio}</div>
              <div class="plan-desc">${plan.descripcion_breve || ''}</div>
              <div class="plan-datos"><b>Duraci√≥n:</b> ${plan.duracion}</div>
              <div class="plan-items">
                <ul>
                  ${items.map(i => `<li><i class="fa fa-check-circle" style="color:#6a1bb1"></i> ${i}</li>`).join('')}
                </ul>
              </div>
              <button class="btn-elegir" onclick="window.location.href='/contratar/${plan.id}/'">
                <i class="fa fa-bolt"></i> Elegir este plan
              </button>
            </div>
          `;
        });
      } catch {
        lista.innerHTML = `<div style="text-align:center;color:#d92b4a;">Error al cargar los planes.</div>`;
      }
    });
  </script>
</body>
</html>
