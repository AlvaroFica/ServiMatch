{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planes del Servicio</title>
  <link rel="stylesheet" href="{% static 'css/ver_planes.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="mobile-container">
    <div id="plans-container" class="plans-grid">
      <!-- aquí se inyectan las tarjetas -->
    </div>
  </div>

  <script>
    (async () => {
      const cont = document.getElementById('plans-container');
      const servicioId = {{ servicio_id }};
      if (!servicioId) {
        cont.innerHTML = '<h1 style="color:red">ID de servicio no proporcionado.</h1>';
        return;
      }

      try {
        // 1) Traer detalles del servicio
        let res = await fetch(`http://localhost:8000/api/servicios/${servicioId}/`);
        if (!res.ok) throw 'Servicio no encontrado';
        const servicio = await res.json();

        // 2) Obtener nombre del primer trabajador
        let nombreTrab = 'Trabajador';
        if (servicio.trabajadores.length) {
          const tId = servicio.trabajadores[0];
          res = await fetch(`http://localhost:8000/api/trabajadores/${tId}/`);
          if (res.ok) {
            const trab = await res.json();
            nombreTrab = `${trab.usuario.nombre} ${trab.usuario.apellido}`;
          }
        }

        // 3) Cabecera
        cont.innerHTML = `
          <h1>Planes de trabajo de ${nombreTrab}</h1>
          <p class="subtitle">Elige el que más te acomode</p>
        `;

        // 4) Si no hay planes
        if (!servicio.planes.length) {
          cont.innerHTML += '<p>No hay planes disponibles.</p>';
          return;
        }

        // 5) Crear una tarjeta por plan
        servicio.planes.forEach(p => {
          const card = document.createElement('div');
          card.className = 'plan-card';
          card.innerHTML = `
            <div class="icon"><i class="fa fa-briefcase"></i></div>
            <div class="info">
              <h3>${p.nombre_plan}</h3>
              <p>${p.descripcion_breve}</p>
            </div>
          `;
            card.addEventListener('click', () => {
            // aquí p.id es el plan, o p.servicio si quieres id de servicio
            window.location.href = `/contratar/${p.id}/`;
          });
          cont.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        cont.innerHTML = '<h1 style="color:red">Error al cargar los planes.</h1>';
      }
    })();
  </script>
</body>
</html>
