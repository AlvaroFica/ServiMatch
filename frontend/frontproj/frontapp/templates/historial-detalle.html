{% extends "layouts/base.html" %}
{% load static humanize %}

{% block head %}
<!-- tu hoja de estilos particular (después de Bootstrap) -->
<link rel="stylesheet" href="{% static 'css/detalle.css' %}">
{% endblock head %}

{% block content %}
<div class="container my-4">

    {% include "layouts/buscador.html" %}

    {# ─────── BOTÓN CALIFICAR (arriba) ─────── #}
    {% if logueado and servicio.trabajadores|length > 0 %}
    <div class="text-end mb-3">
        <button type="button" class="btn btn-primary btn-sm"
            onclick="window.location.href='{% url 'calificar-servicio' servicio.id %}'">
            Calificar trabajador
        </button>
    </div>
    {% endif %}

    {# ─────── RESUMEN ─────── #}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 text-uppercase">Resumen del Servicio</h5>
        </div>
        <div class="card-body d-flex align-items-center">
            {% if servicio.imagenes and servicio.imagenes.0.imagen %}
            <img src="{{ servicio.imagenes.0.imagen }}" class="card-img-top rounded me-3"
                alt="Imagen de {{ servicio.nombre_serv }}">

            {% endif %}


            <div>
                <h4 class="card-title mb-1">{{ servicio.nombre_serv }}</h4>
                <p class="precio mb-1">Precio: ${{ servicio.precio_total }}</p>
                <p class="fecha">Fecha: {{ servicio.fecha|date:"d/m/Y" }}</p>
            </div>
        </div>
    </div>

    {# ─────── DATOS TRABAJADOR ─────── #}
    {% if servicio.trabajadores and servicio.trabajadores.0 %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 text-uppercase">Datos del Trabajador</h5>
        </div>
        <div class="card-body">
            <p><strong>Nombre:</strong>
                {{ servicio.trabajadores.0.nombre }} {{ servicio.trabajadores.0.apellido }}</p>
            <p><strong>Servicio prestado:</strong> {{ servicio.nombre_serv }}</p>
        </div>
    </div>
    {% endif %}

    {# ─────── DETALLES GENERALES ─────── #}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 text-uppercase">Detalles Generales</h5>
        </div>
        <div class="card-body">
            <p><strong>Asunto:</strong> {{ servicio.asunto }}</p>
            <p><strong>Fecha:</strong> {{ servicio.fecha|date:"d/m/Y" }}</p>
            <p><strong>Dirección:</strong> {{ servicio.direccion }}</p>
            <p><strong>Duración estimada:</strong> {{ servicio.duracion_estimada }}</p>
            <p><strong>Duración real:</strong> {{ servicio.duracion_real }}</p>
        </div>
    </div>

    {# ─────── INFORMACIÓN DE PAGO ─────── #}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 text-uppercase">Información de Pago</h5>
        </div>
        <div class="card-body">
            <p><strong>Precio total:</strong> ${{ servicio.precio_total }}</p>
            <p><strong>Comisión ServiMatch:</strong> ${{ servicio.comision_servimatch }}</p>
            <p><strong>Total recibido:</strong> ${{ servicio.total_recibido }}</p>
            <p><strong>Método de pago:</strong> {{ servicio.metodo_pago }}</p>
            <p><strong>Estado de pago:</strong> {{ servicio.estado_pago }}
                {% if servicio.estado_pago == "liberado" %}(Liberado){% endif %}</p>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="{% url 'calificar-servicio' servicio.id %}" class="btn btn-success btn-lg">
            Calificar este servicio
        </a>
    </div>

    {# ─────── BOTÓN CALIFICAR (abajo) ─────── #}
    {% if logueado and servicio.trabajadores|length > 0 %}
    <div class="text-end mb-3">
        <a href="{% url 'calificar-servicio' servicio.id %}" class="btn btn-secondary">
            Calificar trabajador
        </a>
    </div>
    {% endif %}

    <div class="text-end">
        <a href="{% url 'historial-servicio' %}" class="btn btn-outline-secondary">
            ← Volver al Historial
        </a>
    </div>
</div>
<br>
<br>
<br>
<br>

{# (Opcional) futuro: modales de rating o etiquetas #}
{% endblock content %}

{% block menu_inferior %}
{% include "layouts/menu_inferior.html" %}
{% endblock menu_inferior %}